name: Code coverage
on: workflow_dispatch
jobs:
 test:
   runs-on: ubuntu-latest
   steps:
   - name: Checkout code
     uses: actions/checkout@v3
     
   - name: Setup Node.js
     uses: actions/setup-node@v3
     with:
       node-version: "18.x"
       
   - name: Install dependencies
     run: npm install
     
   - name: Run tests with coverage
     run: npm test -- --coverage
   
   - name: Install mutt
     run: sudo apt-get install -y mutt
   - name: Send coverage report via email
     env:
       EMAIL: ${{ secrets.SMTP_USERNAME }}
       EMAIL_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
       RECIPIENT: ${{ secrets.SMTP_TO_EMAIL }}
     run: |
       echo "Code coverage report" | mutt -s "Coverage Report" -a ./coverage/lcov-report/index.html -- $RECIPIENT
